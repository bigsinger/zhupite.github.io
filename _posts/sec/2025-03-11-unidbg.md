---
layout:		post
category:	"sec"
title:		"unidbg的使用汇总"

tags:		[]
---
- Content
{:toc}


# Unidbg 简介

[Unidbg](https://github.com/zhkl0228/unidbg) 是一个基于 Unicorn 引擎的 Android 模拟执行框架，能够让我们在 **无需真实 Android 设备** 或 **不启动 APK** 的情况下执行 SO 库中的 JNI 方法。它主要用于：

- **逆向分析**：解密、协议分析、破解加密算法。
- **自动化测试**：在 PC 端模拟 JNI 调用，提高效率。
- **安全研究**：分析恶意 APK 代码，检测安全漏洞。

## 核心概念

- **AndroidEmulator**：负责创建 Android 模拟器环境，支持 32/64 位。
- **VM（虚拟机）**：`VM` 负责加载 APK 或 DEX，并解析 Java 层调用。
- **DalvikModule（DEX/SO 加载）**：`DalvikModule` 负责加载 Java 层 DEX 代码，同时支持解析 JNI 调用。
- **Module（SO 库封装）**：`Module` 代表一个已加载的 `so` 文件，支持解析导出函数及调用。

# 编译

使用[Maven](https://maven.apache.org/download.cgi)编译，下载解压到本地目录后，进入到unidbg的源码目录，执行编译命令：

```bash
D:\maven\apache-maven-3.9.9\bin\mvn.cmd  clean install -DskipTests
```

编译出错：

```
--- gpg:1.5:sign (default) @ unidbg ---
'gpg.exe' 不是内部或外部命令，也不是可运行的程序或批处理文件。
```

修改 unidbg根目录下的 `pom.xml` 文件，删除如下内容后重新编译即可。

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-gpg-plugin</artifactId>
    <version>1.5</version>
    <executions>
        <execution>
            <phase>verify</phase>
            <goals>
                <goal>sign</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```



# 首次使用

AndroidStudio先随便创建一个安卓应用的工程，然后为工程添加模块，选择 `Java or Kotlin Library`，根据向导填写基本信息。

```groovy
dependencies {
    implementation 'com.github.zhkl0228:unidbg:0.9.8'
}
```



```
.data:0001A6B8                 DCD atargetFunc           ; "targetFunc"
.data:0001A6BC                 DCD aLandroidConten_6   ; "(Landroid/content/Context;I[B[B)I"
.data:0001A6C0                 DCD sub_6A60
```

